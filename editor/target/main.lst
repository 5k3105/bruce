    1                                    * = $C000
    2                                
    3                                    .const lantern_records = $C900
    4                                    // .const LevRecAdr = $C700      // A3-B6?	NOT USED Level Data @ $C700
    5                                
    6                                    .const zpRowCount = $A3
    7                                    .const zpRecStore1 = $A4      // First Record Storage
    8                                    .const zpRecStore2 = $A5      // Second Record Storage
    9                                    .const zpPageFlag = $A6       // Last Page Flag
   10                                    .const zpOutFlag = $A7        // RepOut/NorOut (0/1)
   11                                    .const zpEndFlag = $A8        // End Flag
   12                                
   13                                    .const LevelPtr2 = $A9
   14                                    .const zpLevelLo2 = $A9
   15                                    .const zpLevelHi2 = $AA
   16                                
   17                                    .const ScrnPtr = $AB
   18                                    .const zpScreenLo = $AB
   19                                    .const zpScreenHi = $AC
   20                                
   21                                    .const ColrPtr = $AD
   22                                    .const zpColorLo = $AD
   23                                    .const zpColorHi = $AE
   24                                
   25                                    .const LevelPtr = $AF
   26                                    .const zpLevelLo = $AF
   27                                    .const zpLevelHi = $B0
   28                                
   29                                    //	raster compare: $E2 226 + 8 = $EA 234
   30                                    .const RasCmpL = $D012
   31                                    .const RasCmpH = $D011
   32                                    .const RasEnb = $D01A
   33                                
   34                                    //	sprites
   35                                    .const Sp0X = $D000
   36                                    .const Sp0Y = $D001
   37                                    .const Sp1X = $D002
   38                                    .const Sp1Y = $D003
   39                                    .const SpMSB = $D010
   40                                    .const SpEnable = $D015
   41                                
   42                                    .const SpPtr = $3700
   43                                    .const Sp0ptr = $7F8
   44                                    .const Sp1ptr = $7F9
   45                                    .const Sp2ptr = $BF8          // Color Map Page
   46                                    .const Sp3ptr = $BF9
   47                                
   48                                    //	row static
   49                                    .const Row0 = $400            // $0770  //8C70			status row
   50                                    .const Row1 = $428            // $0798  //8C00
   51                                    .const Row2 = $450            // $07C0  //8C28
   52                                
   53                                    .const Row0c = $D800          // $DB70  //D870			status row
   54                                    .const Row1c = $D828
   55                                    .const Row2c = $D850
   56                                
   57                                    .const Xkey = $24
   58                                    .const OvTmp = $32
   59                                
   60                                    // zp vectors - jump & video matrix
   61                                    .const VcLo = $68
   62                                    .const VcHi = $69
   63                                    .const VmLo = $6A
   64                                    .const VmHi = $6B             // video matrix
   65                                    .const JvLo = $6C
   66                                    .const JvHi = $6D             // jump vector
   67                                
   68                                    // mode variables - temp store & state
   69                                    .const sinc = $6E
   70                                    .const SMst = $6E
   71                                    .const SMode = $6F            // state
   72                                
   73                                    // mode zp vector & count
   74                                    .const SMvLo = $70
   75                                    .const SMvHi = $71
   76                                    .const SMct = $72             // selector mode
   77                                
   78                                    // irq state, count, temp store
   79                                    .const IrqSwitch = $8B        // state
   80                                    .const ColorBuf = $8C         // ?
   81                                    .const IrqCnt = $8D           // unused?
   82                                    .const sprstx = $90
   83                                    .const sprsty = $91
   84                                    .const DSstore = $8E          // temp
   85                                    .const Paintcolor = $8F       // state
   86                                
   87                                    .const ColorListIndx = $92
   88                                    .const RasLineIndx = $93
   89                                    .const CurrentColorIndx = $94
   90                                    .const MemPage = $95
   91                                    .const CopyBuf = $96          // Copy Buffer
   92                                    .const ChrBuf = $97           // Chr Buffer
   93                                
   94                                    .const zp_lantern_index = $98 // Lantern Index
   95                                    .const zp_lantern_row = $99   // Lantern Row
   96                                
   97                                    // Immediate Equates
   98                                    .const CmdKeyLen = $14
   99                                    .const PalletLen = $02
  100                                
  101                                    // XY selector vars
  102                                    .const posx = $F7             // position
  103                                    .const posy = $F8
  104                                    .const Xinc = $F9             // 8
  105                                    .const Yinc = $FA             // 16
  106                                    .const Xbound = $FB           // 40
  107                                    .const Ybound = $FC           // 11
  108                                
  109                                    .const Char = $FD
  110                                    .const Buff = $FE
  111                                
  112                                    .const read_inp = $f142
  113                                
  114                                    // initialize
  115                                    // Ras IRQ setup
  116 C000: 78                           sei
  117 C001: A9 01                        lda #$01
  118 C003: 8D 1A D0                     sta RasEnb
  119                                    //LDA #$E1
  120                                    //STA RasCmpL
  121 C006: A9 1B                        lda #$1B
  122 C008: 8D 11 D0                     sta RasCmpH
  123                                    //STA IrqSwitch
  124 C00B: A9 8E                        lda #<RasIrq
  125 C00D: 8D 14 03                     sta $0314
  126 C010: A9 C3                        lda #>RasIrq
  127 C012: 8D 15 03                     sta $0315
  128                                
  129                                    // disable hw interrupt
  130                                    // keyboard interrupt keeps running
  131 C015: A9 7F                        lda #$7F
  132 C017: 8D 0D DC                     sta $DC0D
  133 C01A: 8D 0D DD                     sta $DD0D
  134 C01D: 58                           cli
  135                                
  136                                clear_sprite_area:
  137                                
  138 C01E: A2 00                        ldx #$00
  139 C020: A9 00                        lda #$00
  140                                
  141                                    {
  142 C022: 9D 00 37                         sta SpPtr, x
  143 C025: E8                               inx
  144 C026: E0 40                            cpx #$40
  145 C028: D0 F8                            bne -
  146                                    }
  147                                
  148 C02A: A9 DC                        lda #$DC
  149 C02C: 8D F8 07                     sta Sp0ptr
  150 C02F: 8D F9 07                     sta Sp1ptr
  151 C032: 8D F8 0B                     sta Sp2ptr
  152 C035: 8D F9 0B                     sta Sp3ptr
  153                                
  154 C038: A9 03                        lda #$03
  155 C03A: 8D 15 D0                     sta SpEnable
  156                                
  157                                    // Sprite Positions
  158 C03D: A9 18                        lda #$18                      // Left
  159 C03F: 85 90                        sta sprstx
  160 C041: 8D 00 D0                     sta Sp0X                      // $D000
  161 C044: A9 4A                        lda #$4A                      // 3A	//Top
  162 C046: 85 91                        sta sprsty
  163 C048: 8D 01 D0                     sta Sp0Y                      // $D001
  164                                
  165 C04B: A9 B0                        lda #$B0
  166 C04D: 8D 02 D0                     sta Sp1X                      // $D002
  167 C050: A9 3A                        lda #$3A                      // EA
  168 C052: 8D 03 D0                     sta Sp1Y                      // $D003
  169                                
  170 C055: A9 00                        lda #$00
  171 C057: 8D 10 D0                     sta SpMSB                     // $D010
  172                                
  173                                    // mem-ctrl: chrset3800,screen400
  174                                    //LDA #$1F
  175                                    //STA $D018
  176                                    //LDA $D016
  177                                    //ORA #%10000
  178                                    //STA $D016	//multi-color
  179                                    // xy char positions
  180 C05A: A9 00                        lda #$00
  181 C05C: 85 F7                        sta posx                      // 00-27 (40)
  182 C05E: 85 F8                        sta posy                      // 00-0A (11)
  183 C060: A9 08                        lda #$08                      // 8
  184 C062: 85 F9                        sta Xinc
  185 C064: A9 10                        lda #$10                      // 16
  186 C066: 85 FA                        sta Yinc
  187 C068: A9 28                        lda #$28                      // 40
  188 C06A: 85 FB                        sta Xbound
  189 C06C: A9 0B                        lda #$0B                      //11 = 22
  190 C06E: 85 FC                        sta Ybound
  191                                
  192                                    // initialize cursor mode (123)
  193 C070: A9 FF                        lda #$FF
  194 C072: 85 6F                        sta SMode
  195 C074: 20 82 C2                     jsr Mode
  196                                
  197                                    // key auto-repeat
  198 C077: A9 80                        lda #$80
  199 C079: 8D 8A 02                     sta $028A
  200                                
  201                                    // skip door displays
  202 C07C: A9 05                        lda #$05
  203 C07E: 85 FD                        sta Char
  204 C080: 85 FE                        sta Buff
  205 C082: 20 BA C4                     jsr ClearScreen
  206                                
  207                                color_screen:
  208                                
  209 C085: A9 08                        lda #$08
  210 C087: 85 8F                        sta Paintcolor
  211 C089: A9 00                        lda #$00
  212 C08B: 8D 20 D0                     sta $D020                     // border color black
  213 C08E: A2 28                        ldx #$28
  214                                
  215                                    {
  216 C090: CA                               dex
  217 C091: 9D 00 D8                         sta Row0c, x
  218 C094: D0 FA                            bne -
  219                                    }
  220                                
  221                                color_pallet:
  222                                
  223 C096: A2 02                        ldx #PalletLen
  224 C098: A0 00                        ldy #$00
  225                                
  226                                    {
  227 C09A: A9 A0                            lda #$A0
  228 C09C: 99 15 04                         sta Row0 + 21, y
  229 C09F: B9 7E C3                         lda ColorPallet, y
  230 C0A2: 38                               sec
  231 C0A3: E9 08                            sbc #$08
  232 C0A5: 99 15 D8                         sta Row0c + 21, y
  233 C0A8: C8                               iny
  234 C0A9: CA                               dex
  235 C0AA: D0 EE                            bne -
  236                                    }
  237                                
  238 C0AC: A9 1F                        lda #$1F
  239 C0AE: 85 95                        sta MemPage
  240 C0B0: 20 9E C4                     jsr ColorMapSetup
  241                                
  242                                    // input
  243                                GETINPUT:
  244                                    {
  245 C0B3: 20 42 F1                     L1: jsr read_inp
  246 C0B6: F0 FB                            beq L1
  247                                
  248 C0B8: A2 00                            ldx #$00
  249 C0BA: DD 1B C3                     L2: cmp KeyM, x
  250 C0BD: F0 13                            beq L3
  251 C0BF: E8                               inx
  252 C0C0: E0 14                            cpx #CmdKeyLen                // length + 1
  253 C0C2: D0 F6                            bne L2
  254                                
  255 C0C4: A2 00                            ldx #$00
  256 C0C6: DD 80 C3                     L5: cmp ColorKey, x
  257 C0C9: F0 27                            beq L6
  258 C0CB: E8                               inx
  259 C0CC: E0 02                            cpx #PalletLen                // length + 1
  260 C0CE: D0 F6                            bne L5
  261 C0D0: F0 E1                            beq L1
  262                                
  263 C0D2: 8A                           L3: txa
  264 C0D3: 0A                               asl
  265 C0D4: AA                               tax
  266 C0D5: BD 2F C3                         lda JmpM, x                   // init vector - reusable JvLo/Hi
  267 C0D8: 85 6C                            sta JvLo
  268 C0DA: 48                               pha
  269 C0DB: E8                               inx
  270 C0DC: BD 2F C3                         lda JmpM, x
  271 C0DF: 85 6D                            sta JvHi
  272 C0E1: 48                               pha
  273 C0E2: A2 00                            ldx #$00
  274 C0E4: 20 EF C0                         jsr L4
  275 C0E7: 68                               pla
  276 C0E8: 68                               pla
  277 C0E9: 20 1B C1                         jsr DrawStatus
  278 C0EC: 18                               clc
  279 C0ED: 90 C4                            bcc L1
  280                                
  281 C0EF: 6C 6C 00                     L4: jmp (JvLo)
  282                                
  283                                        // StoreColor:
  284 C0F2: BD 7E C3                     L6: lda ColorPallet, x
  285 C0F5: 85 8F                            sta Paintcolor
  286 C0F7: A2 28                            ldx #$28
  287                                
  288                                        {
  289 C0F9: CA                                   dex
  290 C0FA: 9D 28 D8                             sta Row1c, x
  291 C0FD: 9D 50 D8                             sta Row2c, x
  292 C100: D0 F7                                bne -
  293                                        }
  294                                
  295 C102: 20 BA C1                         jsr GetV
  296 C105: 20 03 C2                         jsr DrCol
  297 C108: 18                               clc
  298 C109: A5 6A                            lda VmLo
  299 C10B: 69 28                            adc #$28
  300                                
  301                                        {
  302 C10D: 90 04                                bcc +
  303 C10F: E6 6B                                inc VmHi
  304 C111: E6 69                                inc VcHi
  305                                        }
  306                                
  307 C113: 85 6A                            sta VmLo
  308 C115: 20 03 C2                         jsr DrCol
  309                                
  310 C118: 18                               clc
  311 C119: 90 98                            bcc L1
  312                                    }
  313                                    // status bar
  314                                DrawStatus:
  315                                
  316 C11B: A0 00                        ldy #$00
  317 C11D: A9 18                        lda #$18                      // 'X'
  318 C11F: 99 00 04                     sta Row0, y
  319 C122: A5 F7                        lda posx
  320 C124: 85 8E                        sta DSstore
  321 C126: C8                           iny
  322 C127: 20 85 C1                     jsr DSwrite
  323                                
  324 C12A: AD 00 D0                 	lda Sp0X
  325                                //sec
  326                                //sbc #$0c
  327                                //lsr
  328                                //lsr
  329 C12D: 18                       clc
  330 C12E: 69 1D                    adc #$1d
  331                                
  332 C130: 85 8E                    	sta DSstore
  333 C132: C8                       	iny
  334 C133: C8                       	iny
  335 C134: 20 85 C1                 	jsr DSwrite
  336                                 
  337 C137: C8                           iny
  338 C138: C8                           iny
  339 C139: A9 19                        lda #$19                      // 'Y'
  340 C13B: 99 00 04                     sta Row0, y
  341 C13E: C8                           iny
  342 C13F: A5 F8                        lda posy
  343 C141: 85 8E                        sta DSstore
  344 C143: 20 85 C1                     jsr DSwrite
  345                                
  346 C146: AD 01 D0                 	lda Sp0Y
  347 C149: 38                       sec
  348 C14A: E9 1D                    sbc #$1d
  349 C14C: 29 07                    and #$07
  350 C14E: 18                       clc
  351 C14F: 69 15                    adc #$15
  352 C151: 85 8E                    	sta DSstore
  353 C153: C8                       	iny
  354 C154: C8                       	iny
  355 C155: 20 85 C1                 	jsr DSwrite
  356                                
  357 C158: C8                           iny
  358 C159: C8                           iny                           // chrset char
  359 C15A: AD 3B 04                     lda Row1 + 19
  360 C15D: 85 8E                        sta DSstore
  361 C15F: 20 85 C1                     jsr DSwrite
  362                                
  363 C162: 20 BA C1                     jsr GetV                      // char under cursor
  364 C165: A0 00                        ldy #$00
  365 C167: B1 6A                        lda (VmLo), y
  366 C169: 85 8E                        sta DSstore
  367 C16B: A0 12                        ldy #$12 //0E
  368 C16D: 20 85 C1                     jsr DSwrite
  369                                
  370                                    //LDY #$22  		//1E - colors
  371 C170: A9 A0                        lda #$A0
  372 C172: 85 8E                        sta DSstore
  373                                    //LDX #$00
  374 C174: 20 78 C1                     jsr DSwcolor
  375 C177: 60                           rts
  376                                
  377                                DSwcolor:
  378                                
  379 C178: A0 26                        ldy #$26
  380 C17A: A5 8E                        lda DSstore
  381 C17C: 99 00 04                     sta Row0, y
  382 C17F: A5 8F                        lda Paintcolor
  383 C181: 99 00 D8                     sta Row0c, y
  384 C184: 60                           rts
  385                                
  386                                DSwrite:
  387                                
  388 C185: A9 24                        lda #$24                      // '$'
  389 C187: 99 00 04                     sta Row0, y
  390 C18A: A5 8E                        lda DSstore
  391 C18C: 29 F0                        and #$F0
  392 C18E: 18                           clc
  393 C18F: 6A                           ror
  394 C190: 6A                           ror
  395 C191: 6A                           ror
  396 C192: 6A                           ror
  397 C193: AA                           tax
  398 C194: BD 57 C3                     lda HexCodes, x
  399 C197: C8                           iny
  400 C198: 99 00 04                     sta Row0, y
  401 C19B: A5 8E                        lda DSstore
  402 C19D: 29 0F                        and #$0F
  403 C19F: AA                           tax
  404 C1A0: BD 57 C3                     lda HexCodes, x
  405 C1A3: C8                           iny
  406 C1A4: 99 00 04                     sta Row0, y
  407 C1A7: 60                           rts
  408                                
  409                                    // colors
  410                                One:
  411                                
  412 C1A8: A6 94                        ldx CurrentColorIndx
  413 C1AA: FE 6A C3                     inc ColorList, x              // $D021
  414 C1AD: 60                           rts
  415                                Two:
  416                                
  417 C1AE: A6 94                        ldx CurrentColorIndx
  418 C1B0: FE 6B C3                     inc ColorList + 1, x          // $D022
  419 C1B3: 60                           rts
  420                                Three:
  421                                
  422 C1B4: A6 94                        ldx CurrentColorIndx
  423 C1B6: FE 6C C3                     inc ColorList + 2, x          // $d023
  424 C1B9: 60                           rts
  425                                
  426                                    // fill/space
  427                                    // get screen vector using table
  428                                    // input posy,VcTbl,VlTbl,posx
  429                                GetV:
  430                                    {
  431 C1BA: A6 F8                            ldx posy                      //row
  432 C1BC: BD 05 C3                         lda VhTbl, x
  433 C1BF: 85 6B                            sta VmHi                      //video
  434 C1C1: BD FA C2                         lda VcTbl, x
  435 C1C4: 85 69                            sta VcHi                      //color
  436 C1C6: BD 10 C3                         lda VlTbl, x
  437 C1C9: 18                               clc
  438 C1CA: 65 F7                            adc posx                      //column
  439 C1CC: 90 04                            bcc L1
  440 C1CE: E6 6B                            inc VmHi
  441 C1D0: E6 69                            inc VcHi
  442 C1D2: 85 6A                        L1: sta VmLo
  443 C1D4: 60                               rts                           //returns VmHi,VmLo,VcHi,posyx
  444                                    }
  445                                Fill:
  446                                
  447 C1D5: AD 3B 04                     lda Row1 + 19                 //selector character
  448 C1D8: 85 97                        sta ChrBuf
  449 C1DA: 20 DE C1                     jsr WriteChr
  450 C1DD: 60                           rts
  451                                
  452                                WriteChr:
  453                                    {
  454 C1DE: 20 BA C1                         jsr GetV
  455 C1E1: A5 97                            lda ChrBuf                    // selector character
  456 C1E3: 20 15 C2                         jsr DrVid                     // write
  457                                
  458 C1E6: A5 6B                            lda VmHi
  459 C1E8: 48                               pha
  460 C1E9: 20 03 C2                         jsr DrCol
  461                                
  462 C1EC: 68                               pla
  463 C1ED: 85 6B                            sta VmHi
  464 C1EF: A5 6A                            lda VmLo
  465 C1F1: 69 28                            adc #$28
  466 C1F3: 90 04                            bcc L3
  467 C1F5: E6 6B                            inc VmHi
  468 C1F7: E6 69                            inc VcHi
  469 C1F9: 85 6A                        L3: sta VmLo
  470                                
  471 C1FB: A5 97                            lda ChrBuf
  472 C1FD: 18                               clc
  473 C1FE: 69 80                            adc #$80
  474 C200: 20 15 C2                         jsr DrVid
  475                                    }
  476                                
  477                                DrCol:
  478                                    {
  479 C203: A5 69                            lda VcHi
  480 C205: 85 6B                            sta VmHi
  481 C207: A6 6F                            ldx SMode
  482 C209: E8                               inx
  483 C20A: A5 8F                            lda Paintcolor
  484 C20C: A0 00                            ldy #$00
  485 C20E: 91 6A                        L1: sta (VmLo), y
  486 C210: C8                               iny
  487 C211: CA                               dex
  488 C212: D0 FA                            bne L1
  489 C214: 60                               rts
  490                                    }
  491                                
  492                                DrVid:
  493                                    {
  494 C215: A6 6F                            ldx SMode
  495 C217: E8                               inx
  496 C218: A0 00                            ldy #$00
  497 C21A: 18                               clc
  498 C21B: 91 6A                        L2: sta (VmLo), y
  499 C21D: 69 01                            adc #$01
  500 C21F: C8                               iny
  501 C220: CA                               dex
  502 C221: D0 F8                            bne L2
  503 C223: 60                               rts
  504                                    }
  505                                
  506                                Space:
  507                                    {
  508 C224: 20 BA C1                         jsr GetV
  509 C227: A9 00                            lda #$00
  510 C229: 20 38 C2                         jsr DrSp
  511 C22C: A5 6A                            lda VmLo
  512 C22E: 69 28                            adc #$28
  513 C230: 90 02                            bcc L1
  514 C232: E6 6B                            inc VmHi
  515 C234: 85 6A                        L1: sta VmLo
  516 C236: A9 80                            lda #$80
  517                                    }
  518                                
  519                                DrSp:
  520                                    {
  521 C238: A6 6F                            ldx SMode
  522 C23A: E8                               inx
  523 C23B: A0 00                            ldy #$00
  524 C23D: 18                               clc
  525 C23E: 91 6A                        L2: sta (VmLo), y
  526 C240: C8                               iny
  527 C241: CA                               dex
  528 C242: D0 FA                            bne L2
  529 C244: 60                               rts
  530                                    }
  531                                    // plus/minus
  532                                Plus:
  533                                    {
  534 C245: E6 FE                            inc Buff
  535 C247: 10 04                            bpl L1
  536 C249: A9 01                            lda #$01                      // #$06	//#$05
  537 C24B: 85 FE                            sta Buff
  538 C24D: A5 FE                        L1: lda Buff
  539 C24F: 85 FD                            sta Char
  540 C251: 20 6D C2                         jsr Lc1
  541 C254: 60                               rts
  542                                    }
  543                                
  544                                Minus:
  545                                    {
  546 C255: C6 FE                            dec Buff
  547 C257: A5 FE                            lda Buff
  548 C259: C9 00                            cmp #$00                      // #$05
  549 C25B: D0 04                            bne L1
  550 C25D: A9 7F                            lda #$7F
  551 C25F: 85 FE                            sta Buff
  552 C261: A5 FE                        L1: lda Buff
  553 C263: 85 FD                            sta Char
  554 C265: 20 6D C2                         jsr Lc1
  555 C268: 60                               rts
  556                                    }
  557                                pm_end:
  558                                
  559 C269: A9 00                        lda #$00                      // #$05
  560 C26B: 85 FD                        sta Char
  561                                
  562                                Lc1:
  563                                
  564 C26D: E6 FD                        inc Char
  565 C26F: A5 FD                        lda Char                      // 06 START
  566 C271: 30 F6                        bmi pm_end                    // 80
  567 C273: 9D 28 04                     sta Row1, x
  568 C276: 18                           clc
  569 C277: 69 80                        adc #$80
  570 C279: 9D 50 04                     sta Row2, x
  571 C27C: E8                           inx
  572 C27D: E0 28                        cpx #$28
  573 C27F: D0 EC                        bne Lc1
  574 C281: 60                           rts
  575                                
  576                                    // sprite mode
  577                                Mode:
  578                                
  579 C282: A9 DF                        lda #<Sptbl
  580 C284: 85 70                        sta SMvLo
  581 C286: A9 C2                        lda #>Sptbl
  582 C288: 85 71                        sta SMvHi
  583                                
  584 C28A: E6 6F                        inc SMode
  585 C28C: A6 6F                        ldx SMode
  586 C28E: E0 03                        cpx #$03
  587 C290: D0 06                        bne Modetop
  588 C292: A9 00                        lda #$00
  589 C294: 85 6F                        sta SMode
  590 C296: A2 00                        ldx #$00
  591                                
  592                                Modetop:
  593                                
  594 C298: A5 70                        lda SMvLo
  595 C29A: 18                           clc
  596 C29B: 7D DC C2                     adc SMtbl, x
  597 C29E: 85 70                        sta SMvLo
  598 C2A0: 90 02                        bcc SM
  599 C2A2: E6 71                        inc SMvHi
  600                                
  601                                SM: {
  602 C2A4: 78                               sei
  603 C2A5: A2 00                            ldx #$00
  604 C2A7: BD D9 C2                     L1: lda SMcnt, x
  605 C2AA: 48                               pha
  606 C2AB: E8                               inx
  607 C2AC: E0 03                            cpx #$03
  608 C2AE: D0 F7                            bne L1                        // 01,2D,01
  609 C2B0: 86 6E                            stx SMst                      // 3 records
  610                                
  611 C2B2: A2 00                            ldx #$00
  612 C2B4: 68                           L5: pla
  613 C2B5: 85 72                            sta SMct
  614 C2B7: A0 00                        L4: ldy #$00
  615 C2B9: B1 70                        L2: lda (SMvLo), y
  616 C2BB: 9D 00 37                         sta SpPtr, x
  617 C2BE: E8                               inx
  618 C2BF: C8                               iny
  619 C2C0: C0 03                            cpy #$03                      // 3 bytes
  620 C2C2: D0 F5                            bne L2
  621 C2C4: C6 72                            dec SMct
  622 C2C6: D0 EF                            bne L4
  623                                
  624 C2C8: A5 70                            lda SMvLo
  625 C2CA: 18                               clc
  626 C2CB: 69 03                            adc #$03                      // increment record
  627 C2CD: 85 70                            sta SMvLo
  628 C2CF: 90 02                            bcc L3
  629 C2D1: E6 71                            inc SMvHi
  630                                
  631 C2D3: C6 6E                        L3: dec SMst
  632 C2D5: D0 DD                            bne L5
  633 C2D7: 58                               cli
  634 C2D8: 60                               rts
  635                                    }
  636                                
  637                                    // data
  638                                SMcnt:
  639                                
  640 C2D9: 01 0E 01                     .byte $01, $0E, $01
  641                                
  642                                SMtbl:
  643                                
  644 C2DC: 00 09 12                     .byte $00, $09, $12
  645                                
  646                                Sptbl:
  647                                
  648 C2DF: FF 00 00                     .byte $FF, $00, $00
  649 C2E2: 81 00 00                     .byte $81, $00, $00
  650 C2E5: FF 00 00                     .byte $FF, $00, $00
  651                                
  652 C2E8: FF FF 00                     .byte $FF, $FF, $00
  653 C2EB: 80 01 00                     .byte $80, $01, $00
  654 C2EE: FF FF 00                     .byte $FF, $FF, $00
  655                                
  656 C2F1: FF FF FF                     .byte $FF, $FF, $FF
  657 C2F4: 80 00 01                     .byte $80, $00, $01
  658 C2F7: FF FF FF                     .byte $FF, $FF, $FF
  659                                
  660                                VcTbl:
  661                                
  662 C2FA: D8 D8                        .byte $D8, $D8
  663 C2FC: D9 D9 D9                     .byte $D9, $D9, $D9
  664 C2FF: DA DA DA DA                  .byte $DA, $DA, $DA, $DA
  665 C303: DB DB                        .byte $DB, $DB
  666                                
  667                                VhTbl:
  668                                
  669 C305: 04 04                        .byte $04, $04
  670 C307: 05 05 05                     .byte $05, $05, $05
  671 C30A: 06 06 06 06                  .byte $06, $06, $06, $06
  672 C30E: 07 07                        .byte $07, $07
  673                                
  674                                VlTbl:
  675                                
  676 C310: 78 C8                        .byte $78, $C8
  677 C312: 18 68 B8                     .byte $18, $68, $B8
  678 C315: 08 58 A8 F8                  .byte $08, $58, $A8, $F8
  679 C319: 48 98                        .byte $48, $98
  680                                
  681                                    //CmdKeyLen	= $14 - Create Lant Recs key now unnecessary (F7)
  682                                KeyM:
  683                                    //    +	   -    up   dn   lf   rt   sp   z    1    2    3    `    F1   F5
  684 C31B: 2D 2B 91 11 9D 1D 58 5A      .byte $2D, $2B, $91, $11, $9D, $1D, $58, $5A, $31, $32, $33, $5F, $85, $87
  684 C323: 31 32 33 5F 85 87
  685                                    //    c    v    0    9    F7   F8
  686 C329: 43 56 30 39 88 8C            .byte $43, $56, $30, $39, $88, $8C
  687                                
  688                                JmpM:
  689                                
  690 C32F: 45 C2 55 C2 1D C4 2A C4      .word Plus, Minus, up, dn, lf, rt, Space, Fill, One, Two, Three, Mode, ColorMap, ClearScreen
  690 C337: 01 C4 0E C4 24 C2 D5 C1
  690 C33F: A8 C1 AE C1 B4 C1 82 C2
  690 C347: 8E C4 BA C4
  691 C34B: EB C4 F5 C4 FC C4 09 C5      .word Copy, Paste, MoveToChr, ShowDoors, create_lantern_records, Compress
  691 C353: 28 C5 98 C5
  692                                
  693                                HexCodes:
  694                                
  695 C357: 30 31 32 33 34 35 36 37      .byte $30, $31, $32, $33, $34, $35, $36, $37, $38, $39
  695 C35F: 38 39
  696 C361: 01 02 03 04 05 06            .byte $01, $02, $03, $04, $05, $06
  697                                
  698                                RowRas:
  699                                
  700 C367: 02 04 0A                     .byte $02, $04, $0A
  701                                
  702                                ColorList:
  703                                
  704 C36A: FB F1 FE FB F1 FE FB F2      .byte $FB, $F1, $FE, $FB, $F1, $FE, $FB, $F2, $F1, $FC, $F2, $F1// 4x 3(# rasters)
  704 C372: F1 FC F2 F1
  705                                
  706                                RasLine:
  707                                
  708 C376: 3A 49 78 97 FD 78 97 FD      .byte $3A, $49, $78, $97, $FD, $78, $97, $FD
  709                                
  710                                    // PalletLen 	= $02
  711                                ColorPallet:
  712                                
  713 C37E: 08 0E                        .byte $08, $0E                // black=block, blue=climb
  714                                
  715                                    //ColorKeyLen = PalletLen
  716                                ColorKey:
  717                                    //     A   S   D   F   G   H   J   K
  718 C380: 41 53 44 46 47 48 4A 4B      .byte $41, $53, $44, $46, $47, $48, $4A, $4B
  719                                
  720                                lantern_lookup_table:
  721                                
  722 C388: 13 14 31 9E 9F 92            .byte $13, $14, $31, $9E, $9F, $92
  723                                
  724                                    // IRQ
  725                                RasIrq:
  726                                    {
  727 C38E: A9 01                            lda #$01
  728 C390: 8D 1A D0                         sta $D01A                     // raster cmp
  729 C393: 8D 19 D0                         sta $D019                     // raster ack
  730                                
  731 C396: AD 12 D0                         lda $D012
  732 C399: C9 FD                            cmp #$FD
  733 C39B: D0 17                            bne L1
  734                                
  735 C39D: 20 87 EA                         jsr $EA87                     // read keyboard
  736                                
  737 C3A0: AD 16 D0                         lda $D016
  738 C3A3: 29 EF                            and #%11101111
  739 C3A5: 8D 16 D0                         sta $D016                     //multi-color off
  740                                
  741 C3A8: A9 15                            lda #$15                      // regular chrset
  742 C3AA: 8D 18 D0                         sta $D018
  743 C3AD: A9 FC                            lda #$FC                      // med grey
  744 C3AF: 8D 21 D0                         sta $D021                     // status line
  745 C3B2: D0 32                            bne L9
  746                                
  747                                        //L1	TAX : INX : INX : TXA : INX
  748                                        //L10	CPX $D012
  749                                        //		BEQ L12
  750                                        //		CMP $D012
  751                                        //		BNE L10
  752                                        //		LDX #$0A
  753                                        //L11	DEX
  754                                        //		BNE L11
  755                                        //	LDA RasLineIndx
  756                                        //	BNE .L5
  757 C3B4: A5 93                        L1: lda RasLineIndx
  758 C3B6: D0 11                            bne L5
  759                                
  760 C3B8: A5 95                            lda MemPage                   // txt pg & chrset
  761 C3BA: 8D 18 D0                         sta $D018
  762                                
  763 C3BD: AD 16 D0                         lda $D016
  764 C3C0: 09 10                            ora #%10000
  765 C3C2: 8D 16 D0                         sta $D016                     //multi-color on
  766                                
  767 C3C5: A6 94                            ldx CurrentColorIndx
  768 C3C7: D0 02                            bne L7
  769                                
  770 C3C9: A6 92                        L5: ldx ColorListIndx
  771 C3CB: BD 6A C3                     L7: lda ColorList, x
  772 C3CE: 8D 21 D0                         sta $D021
  773 C3D1: BD 6B C3                         lda ColorList + 1, x
  774 C3D4: 8D 22 D0                         sta $D022
  775 C3D7: BD 6C C3                         lda ColorList + 2, x
  776 C3DA: 8D 23 D0                         sta $D023
  777                                
  778 C3DD: A5 92                            lda ColorListIndx             // next color record
  779 C3DF: 18                               clc
  780 C3E0: 69 03                            adc #$03
  781 C3E2: 85 92                            sta ColorListIndx
  782                                
  783 C3E4: E6 93                            inc RasLineIndx               // next raster record
  784 C3E6: A6 93                        L9: ldx RasLineIndx
  785 C3E8: BD 76 C3                         lda RasLine, x
  786                                
  787 C3EB: 8D 12 D0                     L2: sta $D012
  788 C3EE: C9 FD                            cmp #$FD                      // end of screen
  789 C3F0: F0 06                            beq L3
  790                                
  791 C3F2: 68                           L4: pla
  792 C3F3: A8                               tay
  793 C3F4: 68                               pla
  794 C3F5: AA                               tax
  795 C3F6: 68                               pla
  796 C3F7: 40                               rti
  797                                
  798 C3F8: A9 00                        L3: lda #$00
  799 C3FA: 85 93                            sta RasLineIndx
  800 C3FC: 85 92                            sta ColorListIndx
  801 C3FE: 4C F2 C3                         jmp L4
  802                                    }
  803                                
  804                                    // direction (l/r/u/d)
  805                                direction_move:
  806                                
  807                                lf: {
  808 C401: A6 F7                            ldx posx
  809 C403: CA                               dex
  810 C404: 10 02                            bpl L1                        // >#$80?
  811 C406: A2 27                            ldx #$27
  812 C408: 86 F7                        L1: stx posx
  813 C40A: 20 39 C4                         jsr sprposinitx
  814 C40D: 60                               rts
  815                                    }
  816                                
  817                                rt: {
  818 C40E: A6 F7                            ldx posx
  819 C410: E8                               inx
  820 C411: E4 FB                            cpx Xbound
  821 C413: 90 02                            bcc L2                        // <#$28?
  822 C415: A2 00                            ldx #$00
  823 C417: 86 F7                        L2: stx posx
  824 C419: 20 39 C4                         jsr sprposinitx
  825 C41C: 60                               rts
  826                                    }
  827                                
  828                                up: {
  829 C41D: A6 F8                            ldx posy
  830 C41F: CA                               dex
  831 C420: 10 02                            bpl L3
  832 C422: A2 0A                            ldx #$0A
  833 C424: 86 F8                        L3: stx posy
  834 C426: 20 58 C4                         jsr sprposinity
  835 C429: 60                               rts
  836                                    }
  837                                
  838                                dn: {
  839 C42A: A6 F8                            ldx posy
  840 C42C: E8                               inx
  841 C42D: E4 FC                            cpx Ybound
  842 C42F: 90 02                            bcc L4
  843 C431: A2 00                            ldx #$00
  844 C433: 86 F8                        L4: stx posy
  845 C435: 20 58 C4                         jsr sprposinity
  846 C438: 60                               rts
  847                                    }
  848                                
  849                                sprposinitx:
  850                                    {
  851 C439: A0 00                            ldy #$00
  852 C43B: 8C 10 D0                         sty SpMSB
  853 C43E: 8A                               txa
  854 C43F: 0A                               asl
  855 C440: 0A                               asl
  856 C441: 0A                               asl
  857 C442: 90 09                            bcc L5
  858 C444: EE 10 D0                         inc SpMSB
  859 C447: 69 17                            adc #$17
  860 C449: 8D 00 D0                         sta Sp0X
  861 C44C: 60                               rts
  862 C44D: 65 90                        L5: adc sprstx
  863 C44F: 90 03                            bcc L6
  864 C451: EE 10 D0                         inc SpMSB
  865 C454: 8D 00 D0                     L6: sta Sp0X
  866 C457: 60                               rts
  867                                    }
  868                                
  869                                sprposinity:
  870                                
  871 C458: 8A                           txa
  872 C459: 0A                           asl
  873 C45A: 0A                           asl
  874 C45B: 0A                           asl
  875 C45C: 0A                           asl
  876 C45D: 65 91                        adc sprsty
  877 C45F: 8D 01 D0                     sta Sp0Y
  878 C462: 20 66 C4                     jsr ChrColorBar
  879 C465: 60                           rts
  880                                
  881                                ChrColorBar:
  882                                    {
  883 C466: A0 FF                            ldy #$FF
  884 C468: A2 00                            ldx #$00
  885 C46A: E8                           L1: inx
  886 C46B: E8                               inx
  887 C46C: E8                               inx                           //set chrset bar colors
  888 C46D: C8                               iny
  889 C46E: B9 67 C3                         lda RowRas, y
  890 C471: C5 F8                            cmp posy
  891 C473: 90 F5                            bcc L1
  892 C475: 86 94                            stx CurrentColorIndx
  893                                
  894 C477: A0 00                            ldy #$00                      //save to chrset color bar buffer
  895 C479: A9 A0                        L2: lda #$A0                      //& update status
  896 C47B: 99 22 04                         sta Row0 + 34, y
  897 C47E: BD 6A C3                         lda ColorList, x
  898 C481: 99 6A C3                         sta ColorList, y
  899 C484: 99 22 D8                         sta Row0c + 34, y
  900 C487: E8                               inx
  901 C488: C8                               iny
  902 C489: C0 03                            cpy #$03
  903 C48B: D0 EC                            bne L2
  904                                
  905 C48D: 60                               rts
  906                                    }
  907                                
  908                                    // F1
  909                                ColorMap:
  910                                    {
  911 C48E: A5 95                            lda MemPage
  912 C490: C9 1F                            cmp #$1F
  913 C492: F0 05                            beq L1
  914 C494: A9 1F                            lda #$1F
  915 C496: 85 95                            sta MemPage
  916 C498: 60                               rts
  917 C499: A9 2F                        L1: lda #$2F
  918 C49B: 85 95                            sta MemPage
  919 C49D: 60                               rts
  920                                    }
  921                                
  922                                    // Set up Color Map Page
  923                                ColorMapSetup:
  924                                    {
  925 C49E: A2 11                            ldx #$11
  926                                
  927 C4A0: BD 05 C3                     L2: lda VhTbl, x
  928 C4A3: 69 04                            adc #$04
  929 C4A5: 85 6B                            sta VmHi
  930 C4A7: BD 10 C3                         lda VlTbl, x
  931 C4AA: 85 6A                            sta VmLo
  932                                
  933 C4AC: A0 51                            ldy #$51                      // 81
  934                                
  935 C4AE: 88                           L1: dey
  936 C4AF: A9 06                            lda #$06
  937 C4B1: 91 6A                            sta (VmLo), y
  938 C4B3: 98                               tya
  939 C4B4: D0 F8                            bne L1
  940                                
  941 C4B6: CA                               dex
  942 C4B7: 10 E7                            bpl L2
  943 C4B9: 60                               rts
  944                                    }
  945                                
  946                                    // F5
  947                                ClearScreen:
  948                                    {
  949 C4BA: A2 0A                            ldx #$0A
  950 C4BC: BD 05 C3                     L2: lda VhTbl, x
  951 C4BF: 85 6B                            sta VmHi
  952 C4C1: BD 10 C3                         lda VlTbl, x
  953 C4C4: 85 6A                            sta VmLo
  954                                
  955 C4C6: A0 51                            ldy #$51                      // 81
  956 C4C8: A9 00                            lda #$00
  957 C4CA: 88                           L1: dey
  958 C4CB: 91 6A                            sta (VmLo), y
  959 C4CD: D0 FB                            bne L1
  960 C4CF: CA                               dex
  961 C4D0: 10 EA                            bpl L2
  962                                
  963 C4D2: A2 0A                            ldx #$0A
  964 C4D4: BD FA C2                     L3: lda VcTbl, x
  965 C4D7: 85 6B                            sta VmHi
  966 C4D9: BD 10 C3                         lda VlTbl, x
  967 C4DC: 85 6A                            sta VmLo
  968                                
  969 C4DE: A0 51                            ldy #$51                      // 81
  970 C4E0: A9 0E                            lda #$0E
  971 C4E2: 88                           L4: dey
  972 C4E3: 91 6A                            sta (VmLo), y
  973 C4E5: D0 FB                            bne L4
  974 C4E7: CA                               dex
  975 C4E8: 10 EA                            bpl L3
  976 C4EA: 60                               rts
  977                                    }
  978                                
  979                                    // Copy/Paste (C/V)
  980                                Copy:
  981                                
  982 C4EB: 20 BA C1                     jsr GetV                      //char under cursor
  983 C4EE: A0 00                        ldy #$00
  984 C4F0: B1 6A                        lda (VmLo), y
  985 C4F2: 85 96                        sta CopyBuf
  986 C4F4: 60                           rts
  987                                
  988                                Paste:
  989                                
  990 C4F5: A5 96                        lda CopyBuf
  991 C4F7: 85 97                        sta ChrBuf
  992 C4F9: 4C DE C1                     jmp WriteChr
  993                                
  994                                    // 0
  995                                MoveToChr:
  996                                
  997 C4FC: 20 BA C1                     jsr GetV                      //char under cursor
  998 C4FF: A0 00                        ldy #$00
  999 C501: B1 6A                        lda (VmLo), y
 1000                                    //		CLC
 1001                                    //		SBC #$10
 1002                                    //		STA Buff
 1003                                    //		INC Buff
 1004 C503: 85 FD                        sta Char
 1005 C505: 20 6D C2                     jsr Lc1
 1006                                    //		JSR Minus
 1007 C508: 60                           rts
 1008                                
 1009                                    // Import Charcters 1-5
 1010                                    // 9
 1011                                ShowDoors:
 1012                                    {
 1013 C509: 78                               sei
 1014 C50A: A5 01                            lda $01
 1015 C50C: 29 FB                            and #$FB
 1016 C50E: 85 01                            sta $01
 1017                                
 1018 C510: A2 FF                            ldx #$FF
 1019 C512: E8                           L1: inx
 1020 C513: BD 88 D1                         lda $D188, x
 1021 C516: 9D 08 38                         sta $3808, x
 1022 C519: 9D 08 3C                         sta $3C08, x
 1023 C51C: E0 27                            cpx #$27
 1024 C51E: D0 F2                            bne L1
 1025                                
 1026 C520: A5 01                            lda $01
 1027 C522: 09 04                            ora #$04
 1028 C524: 85 01                            sta $01
 1029 C526: 58                               cli
 1030 C527: 60                               rts
 1031                                    }
 1032                                
 1033                                    // moved to Compressor .. F7 = #$88
 1034                                create_lantern_records:
 1035                                    {
 1036 C528: A9 00                            lda #$00
 1037 C52A: 85 98                            sta zp_lantern_index
 1038 C52C: A9 FF                            lda #$ff
 1039 C52E: 85 99                            sta zp_lantern_row
 1040                                
 1041 C530: E6 99                        L3: inc zp_lantern_row
 1042 C532: A5 99                            lda zp_lantern_row
 1043 C534: C9 0C                            cmp #$0c                      // $0a is last row
 1044 C536: F0 51                            beq L4                        // rts
 1045                                
 1046 C538: A6 99                            ldx zp_lantern_row
 1047 C53A: BD 05 C3                         lda VhTbl, x
 1048 C53D: 85 6B                            sta VmHi
 1049 C53F: BD 10 C3                         lda VlTbl, x
 1050 C542: 85 6A                            sta VmLo
 1051                                
 1052 C544: A0 FF                            ldy #$ff                      // column
 1053 C546: C0 27                        L2: cpy #$27                      // (VmLo),y
 1054 C548: F0 E6                            beq L3                        // next row
 1055 C54A: A2 FF                            ldx #$ff                      // lantern_lookup_table,x
 1056 C54C: C8                               iny                           // next column
 1057 C54D: B1 6A                            lda (VmLo), y
 1058 C54F: E8                           L1: inx
 1059 C550: DD 88 C3                         cmp lantern_lookup_table, x
 1060 C553: F0 06                            beq L5
 1061 C555: E0 02                            cpx #$02                      // 0->2 = 3
 1062 C557: D0 F6                            bne L1
 1063 C559: F0 EB                            beq L2
 1064                                
 1065 C55B: E8                           L5: inx
 1066 C55C: E8                               inx
 1067 C55D: E8                               inx
 1068 C55E: BD 88 C3                         lda lantern_lookup_table, x
 1069 C561: 48                               pha
 1070 C562: A9 01                            lda #$01
 1071 C564: E6 98                            inc zp_lantern_index
 1072 C566: A6 98                            ldx zp_lantern_index
 1073 C568: 9D 00 C9                         sta lantern_records, x        // ON/OFF
 1074                                
 1075 C56B: 68                               pla
 1076 C56C: E6 98                            inc zp_lantern_index
 1077 C56E: A6 98                            ldx zp_lantern_index
 1078 C570: 9D 00 C9                         sta lantern_records, x        // image stored
 1079                                
 1080 C573: 98                               tya
 1081 C574: E6 98                            inc zp_lantern_index
 1082 C576: A6 98                            ldx zp_lantern_index
 1083 C578: 9D 00 C9                         sta lantern_records, x        // column
 1084                                
 1085 C57B: A5 99                            lda zp_lantern_row
 1086 C57D: 69 01                            adc #$01
 1087 C57F: E6 98                            inc zp_lantern_index
 1088 C581: A6 98                            ldx zp_lantern_index
 1089 C583: 9D 00 C9                         sta lantern_records, x        // row + 2
 1090                                
 1091 C586: 18                               clc
 1092 C587: 90 BD                            bcc L2
 1093                                
 1094 C589: A9 FF                        L4: lda #$ff
 1095 C58B: E6 98                            inc zp_lantern_index
 1096 C58D: A6 98                            ldx zp_lantern_index
 1097 C58F: 9D 00 C9                         sta lantern_records, x
 1098 C592: A5 98                            lda zp_lantern_index
 1099 C594: 8D 00 C9                         sta lantern_records           // length 1st byte
 1100 C597: 60                               rts
 1101                                    }
 1102                                    
 1103                                    // compressor
 1104                                    // jsr Create Lant Recs after finished compiling level
 1105                                    // F8 = #$8C
 1106                                    
 1107                                Compress:                         // SEI
 1108                                
 1109 C598: A9 27                        lda #$27
 1110 C59A: 85 A3                        sta zpRowCount
 1111 C59C: A9 04                        lda #$04
 1112 C59E: 85 AC                        sta zpScreenHi
 1113 C5A0: A9 78                        lda #$78
 1114 C5A2: 85 AB                        sta zpScreenLo                // $0478
 1115 C5A4: A9 D8                        lda #$D8
 1116 C5A6: 85 AE                        sta zpColorHi
 1117 C5A8: A9 78                        lda #$78
 1118 C5AA: 85 AD                        sta zpColorLo                 // $D878
 1119 C5AC: A9 C7                        lda #$C7
 1120 C5AE: 85 B0                        sta zpLevelHi
 1121                                
 1122 C5B0: A0 00                        ldy #$00
 1123 C5B2: 84 A6                        sty zpPageFlag
 1124 C5B4: 84 A7                        sty zpOutFlag
 1125 C5B6: 84 A8                        sty zpEndFlag
 1126 C5B8: 84 AF                        sty zpLevelLo
 1127                                
 1128                                Top:
 1129                                
 1130 C5BA: A5 A8                        lda zpEndFlag
 1131 C5BC: D0 53                        bne End
 1132 C5BE: A2 00                        ldx #$00
 1133 C5C0: 20 46 C6                     jsr Fetch
 1134 C5C3: 85 A4                        sta zpRecStore1
 1135 C5C5: E8                           inx
 1136 C5C6: 20 19 C6                     jsr IncScrnPtr
 1137 C5C9: F0 2E                        beq Repeater
 1138                                
 1139 C5CB: E6 A7                        inc zpOutFlag
 1140 C5CD: A5 AF                        lda zpLevelLo
 1141 C5CF: 85 A9                        sta zpLevelLo2
 1142 C5D1: A5 B0                        lda zpLevelHi
 1143 C5D3: 85 AA                        sta zpLevelHi2
 1144 C5D5: 20 74 C6                     jsr IncLevPtr
 1145                                
 1146                                Nor:
 1147                                
 1148 C5D8: A5 A4                        lda zpRecStore1
 1149 C5DA: 91 AF                        sta (LevelPtr), y
 1150 C5DC: 20 74 C6                     jsr IncLevPtr
 1151 C5DF: E8                           inx
 1152 C5E0: 30 09                        bmi NorOut
 1153 C5E2: A5 A5                        lda zpRecStore2
 1154 C5E4: 85 A4                        sta zpRecStore1
 1155 C5E6: 20 19 C6                     jsr IncScrnPtr
 1156 C5E9: D0 ED                        bne Nor
 1157                                    
 1158                                NorOut:
 1159                                
 1160 C5EB: CA                           dex
 1161 C5EC: 8A                           txa
 1162 C5ED: 09 80                        ora #$80
 1163 C5EF: 91 A9                        sta (LevelPtr2), y
 1164 C5F1: C6 A7                        dec zpOutFlag
 1165 C5F3: A5 A8                        lda zpEndFlag
 1166 C5F5: D0 1A                        bne End
 1167 C5F7: A2 01                        ldx #$01
 1168                                
 1169                                Repeater:
 1170                                
 1171 C5F9: E8                           inx
 1172 C5FA: 30 05                        bmi RepOut
 1173 C5FC: 20 19 C6                     jsr IncScrnPtr
 1174 C5FF: F0 F8                        beq Repeater
 1175                                    
 1176                                RepOut:
 1177                                
 1178 C601: 8A                           txa
 1179 C602: 91 AF                        sta (LevelPtr), y
 1180 C604: 20 74 C6                     jsr IncLevPtr
 1181 C607: A5 A4                        lda zpRecStore1
 1182 C609: 91 AF                        sta (LevelPtr), y
 1183 C60B: 20 74 C6                     jsr IncLevPtr
 1184 C60E: 4C BA C5                     jmp Top
 1185                                
 1186                                End:
 1187                                
 1188 C611: A9 80                        lda #$80
 1189 C613: 91 AF                        sta (LevelPtr), y
 1190 C615: 20 28 C5                     jsr create_lantern_records
 1191 C618: 60                           rts
 1192                                    
 1193                                    // first byte of lantern_records = length
 1194                                    // zpLevelLo/Hi = End Adr
 1195                                    
 1196                                IncScrnPtr:
 1197                                
 1198 C619: C6 A3                        dec zpRowCount
 1199 C61B: 10 13                        bpl RowOut
 1200 C61D: A9 27                        lda #$27
 1201 C61F: 85 A3                        sta zpRowCount
 1202 C621: A5 AB                        lda zpScreenLo
 1203 C623: 18                           clc
 1204 C624: 69 28                        adc #$28
 1205 C626: 85 AB                        sta zpScreenLo
 1206 C628: 85 AD                        sta zpColorLo
 1207 C62A: 90 04                        bcc RowOut
 1208 C62C: E6 AC                        inc zpScreenHi
 1209 C62E: E6 AE                        inc zpColorHi
 1210                                
 1211                                RowOut:
 1212                                
 1213 C630: A5 A6                        lda zpPageFlag
 1214 C632: D0 34                        bne LastPage
 1215 C634: E6 AB                        inc zpScreenLo
 1216 C636: E6 AD                        inc zpColorLo
 1217 C638: D0 0C                        bne Fetch
 1218 C63A: E6 AC                        inc zpScreenHi
 1219 C63C: E6 AE                        inc zpColorHi
 1220 C63E: A5 AC                        lda zpScreenHi
 1221 C640: C9 07                        cmp #$07
 1222 C642: D0 02                        bne Fetch
 1223 C644: E6 A6                        inc zpPageFlag
 1224                                
 1225                                Fetch:
 1226                                
 1227 C646: B1 AD                        lda (ColrPtr), y
 1228 C648: 29 0F                        and #$0F
 1229 C64A: C9 08                        cmp #$08
 1230 C64C: D0 09                        bne NoColr
 1231 C64E: B1 AB                        lda (ScrnPtr), y
 1232 C650: 09 80                        ora #$80
 1233 C652: 85 A5                        sta zpRecStore2
 1234 C654: C5 A4                        cmp zpRecStore1
 1235 C656: 60                           rts
 1236                                
 1237                                NoColr:
 1238                                
 1239 C657: B1 AB                        lda (ScrnPtr), y
 1240 C659: 85 A5                        sta zpRecStore2
 1241 C65B: C5 A4                        cmp zpRecStore1
 1242 C65D: 60                           rts
 1243                                
 1244                                Exit:
 1245                                
 1246 C65E: E6 A8                        inc zpEndFlag
 1247 C660: 68                           pla
 1248 C661: 68                           pla
 1249 C662: A5 A7                        lda zpOutFlag
 1250 C664: F0 9B                        beq RepOut
 1251 C666: D0 83                        bne NorOut
 1252                                
 1253                                LastPage:
 1254                                
 1255 C668: E6 AB                        inc zpScreenLo
 1256 C66A: E6 AD                        inc zpColorLo
 1257 C66C: A5 AB                        lda zpScreenLo
 1258 C66E: C9 E8                        cmp #$E8
 1259 C670: F0 EC                        beq Exit
 1260 C672: D0 D2                        bne Fetch
 1261                                
 1262                                IncLevPtr:
 1263                                
 1264 C674: E6 AF                        inc zpLevelLo
 1265 C676: D0 02                        bne LevPtrOut
 1266 C678: E6 B0                        inc zpLevelHi
 1267                                    
 1268                                LevPtrOut:
 1269                                
 1270 C67A: 60                           rts
 1271                                
 1272                                    // note: to find color ram in vice, search for 0 hi nyble instead of f ie.. 02 04 06 08 01 03 05 07 09
 1273